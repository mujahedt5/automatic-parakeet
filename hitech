<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ Ø´Ø±ÙƒØ© Ù‡Ø§ÙŠ ØªÙƒ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --info-color: #06b6d4;
            --light-color: #f8fafc;
            --dark-color: #1e293b;
            --border-radius: 12px;
            --box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            font-family: 'Cairo', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 0;
            margin: 0;
        }

        .main-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            margin: 20px;
            padding: 30px;
            box-shadow: var(--box-shadow);
            min-height: calc(100vh - 40px);
        }

        .header-section {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 0;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: var(--border-radius);
            position: relative;
            overflow: hidden;
        }

        .header-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .header-section h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 0;
            position: relative;
            z-index: 1;
        }

        .header-section p {
            font-size: 1.1rem;
            margin: 10px 0 0 0;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .filters-section {
            background: white;
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .filters-section h5 {
            color: var(--dark-color);
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-control, .form-select {
            border-radius: 8px;
            border: 2px solid #e2e8f0;
            padding: 12px 16px;
            font-size: 14px;
            transition: var(--transition);
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
            outline: none;
        }

        .input-group {
            position: relative;
        }

        .input-group .form-control {
            padding-right: 45px;
        }

        .input-group .input-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #64748b;
            z-index: 3;
        }

        .control-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            border-radius: 8px;
            padding: 12px 24px;
            font-weight: 600;
            transition: var(--transition);
            border: none;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: var(--transition);
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-color), #059669);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning-color), #d97706);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, var(--info-color), #0891b2);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .nav-tabs {
            border: none;
            margin-bottom: 30px;
            background: white;
            border-radius: var(--border-radius);
            padding: 10px;
            box-shadow: var(--box-shadow);
        }

        .nav-tabs .nav-link {
            border: none;
            border-radius: 8px;
            padding: 15px 25px;
            font-weight: 600;
            color: var(--dark-color);
            transition: var(--transition);
            margin: 0 5px;
        }

        .nav-tabs .nav-link:hover {
            background: rgba(37, 99, 235, 0.1);
            color: var(--primary-color);
        }

        .nav-tabs .nav-link.active {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
        }

        .tab-content {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--box-shadow);
            min-height: 400px;
        }

        .loading-spinner {
            text-align: center;
            padding: 50px;
            color: #64748b;
        }

        .loading-spinner i {
            font-size: 2rem;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .card {
            border: none;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .card-body {
            padding: 25px;
        }

        .priority-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .priority-1 { background: #fee2e2; color: #dc2626; }
        .priority-2 { background: #fef3c7; color: #d97706; }
        .priority-3 { background: #dcfce7; color: #16a34a; }

        .status-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-open { background: #dbeafe; color: #2563eb; }
        .status-in_progress { background: #fef3c7; color: #d97706; }
        .status-solved { background: #dcfce7; color: #16a34a; }
        .status-closed { background: #f3f4f6; color: #6b7280; }

        @media (max-width: 768px) {
            .main-container {
                margin: 10px;
                padding: 20px;
            }
            
            .header-section h1 {
                font-size: 2rem;
            }
            
            .control-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                margin-bottom: 10px;
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="main-container fade-in">
        <div class="header-section">
            <h1><i class="fas fa-tools"></i> Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ Ø´Ø±ÙƒØ© Ù‡Ø§ÙŠ ØªÙƒ</h1>
            <p>Ù†Ø¸Ø§Ù… Ù…ØªÙ‚Ø¯Ù… Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„ØªÙ‚Ù†ÙŠØ© ÙˆØ§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</p>
        </div>

        <div class="filters-section">
            <h5><i class="fas fa-filter"></i> ÙÙ„Ø§ØªØ± Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ©</h5>
            <div class="row g-3">
                <div class="col-md-6 col-lg-3">
                    <div class="input-group">
                        <input type="text" class="form-control" id="searchInput" placeholder="Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„...">
                        <span class="input-icon"><i class="fas fa-search"></i></span>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="input-group">
                        <select class="form-select" id="statusFilter">
                            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                            <option value="open">ğŸ”´ Ù…ÙØªÙˆØ­Ø©</option>
                            <option value="in_progress">ğŸŸ¡ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</option>
                            <option value="solved">ğŸŸ¢ Ù…Ø­Ù„ÙˆÙ„Ø©</option>
                            <option value="closed">âš« Ù…ØºÙ„Ù‚Ø©</option>
                        </select>
                        <span class="input-icon"><i class="fas fa-tasks"></i></span>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="input-group">
                        <select class="form-select" id="priorityFilter">
                            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ§Øª</option>
                            <option value="1">ğŸ”¥ Ø¹Ø§Ù„ÙŠØ©</option>
                            <option value="2">âš¡ Ù…ØªÙˆØ³Ø·Ø©</option>
                            <option value="3">ğŸ“ Ù…Ù†Ø®ÙØ¶Ø©</option>
                        </select>
                        <span class="input-icon"><i class="fas fa-exclamation-triangle"></i></span>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="input-group">
                        <input type="text" class="form-control" id="modelFilter" placeholder="Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø·Ø±Ø§Ø²...">
                        <span class="input-icon"><i class="fas fa-print"></i></span>
                    </div>
                </div>
            </div>
        </div>

        <div class="control-buttons">
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addIssueModal">
                <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ø´ÙƒÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©
            </button>
            <button class="btn btn-success" id="refreshData">
                <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            </button>
            <button class="btn btn-info" id="exportData">
                <i class="fas fa-download"></i> ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            </button>
            <button class="btn btn-warning" id="clearFilters">
                <i class="fas fa-eraser"></i> Ù…Ø³Ø­ Ø§Ù„ÙÙ„Ø§ØªØ±
            </button>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addClientModal">
                <i class="fas fa-user-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„
            </button>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addTechnicianModal">
                <i class="fas fa-user-tie"></i> Ø¥Ø¶Ø§ÙØ© ÙÙ†ÙŠ
            </button>
        </div>

        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item">
                <button class="nav-link active" id="issues-tab" data-bs-toggle="tab" data-bs-target="#issues" type="button" role="tab">
                    <i class="fas fa-bug"></i> Ø§Ù„Ù…Ø´Ø§ÙƒÙ„
                    <span class="badge bg-light text-dark ms-2" id="issuesCount">0</span>
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" id="clients-tab" data-bs-toggle="tab" data-bs-target="#clients" type="button" role="tab">
                    <i class="fas fa-users"></i> Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
                    <span class="badge bg-light text-dark ms-2" id="clientsCount">0</span>
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" id="technicians-tab" data-bs-toggle="tab" data-bs-target="#technicians" type="button" role="tab">
                    <i class="fas fa-hard-hat"></i> Ø§Ù„ÙÙ†ÙŠÙˆÙ†
                    <span class="badge bg-light text-dark ms-2" id="techniciansCount">0</span>
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" id="stats-tab" data-bs-toggle="tab" data-bs-target="#stats" type="button" role="tab">
                    <i class="fas fa-chart-bar"></i> Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" id="dashboard-tab" data-bs-toggle="tab" data-bs-target="#dashboard" type="button" role="tab">
                    <i class="fas fa-tachometer-alt"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                </button>
            </li>
        </ul>

        <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="issues" role="tabpanel">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4><i class="fas fa-list"></i> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´Ø§ÙƒÙ„</h4>
                    <div class="d-flex gap-2">
                        <button class="btn btn-outline-primary btn-sm" id="listView">
                            <i class="fas fa-list"></i> Ù‚Ø§Ø¦Ù…Ø©
                        </button>
                        <button class="btn btn-outline-primary btn-sm" id="cardView">
                            <i class="fas fa-th"></i> Ø¨Ø·Ø§Ù‚Ø§Øª
                        </button>
                    </div>
                </div>
                <div id="issuesList">
                    <div class="loading-spinner">
                        <i class="fas fa-spinner"></i>
                        <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„...</p>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="clients" role="tabpanel">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4><i class="fas fa-users"></i> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h4>
                    <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addClientModal">
                        <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„
                    </button>
                </div>
                <div id="clientsList">
                    <div class="loading-spinner">
                        <i class="fas fa-spinner"></i>
                        <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡...</p>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="technicians" role="tabpanel">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4><i class="fas fa-hard-hat"></i> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙÙ†ÙŠÙŠÙ†</h4>
                    <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addTechnicianModal">
                        <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© ÙÙ†ÙŠ
                    </button>
                </div>
                <div id="techniciansList">
                    <div class="loading-spinner">
                        <i class="fas fa-spinner"></i>
                        <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙ†ÙŠÙŠÙ†...</p>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="stats" role="tabpanel">
                <h4><i class="fas fa-chart-line"></i> Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©</h4>
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card border-0 bg-primary text-white">
                            <div class="card-body text-center">
                                <i class="fas fa-bug fa-2x mb-2"></i>
                                <h5 class="card-title">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„</h5>
                                <h2 class="card-text" id="totalIssues">0</h2>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card border-0 bg-warning text-white">
                            <div class="card-body text-center">
                                <i class="fas fa-clock fa-2x mb-2"></i>
                                <h5 class="card-title">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</h5>
                                <h2 class="card-text" id="inProgressIssues">0</h2>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card border-0 bg-success text-white">
                            <div class="card-body text-center">
                                <i class="fas fa-check-circle fa-2x mb-2"></i>
                                <h5 class="card-title">Ù…Ø­Ù„ÙˆÙ„Ø©</h5>
                                <h2 class="card-text" id="solvedIssues">0</h2>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card border-0 bg-danger text-white">
                            <div class="card-body text-center">
                                <i class="fas fa-exclamation-triangle fa-2x mb-2"></i>
                                <h5 class="card-title">Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</h5>
                                <h2 class="card-text" id="highPriorityIssues">0</h2>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="statsList">
                    <div class="loading-spinner">
                        <i class="fas fa-spinner"></i>
                        <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª...</p>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="dashboard" role="tabpanel">
                <h4><i class="fas fa-tachometer-alt"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h4>
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-chart-pie"></i> ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="statusChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-chart-bar"></i> Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø­Ø³Ø¨ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="priorityChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="addIssueModal" tabindex="-1" aria-labelledby="addIssueModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="addIssueModalLabel">
                        <i class="fas fa-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ø´ÙƒÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addIssueForm">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">
                                    <i class="fas fa-heading"></i> Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø´ÙƒÙ„Ø© *
                                </label>
                                <input type="text" class="form-control" id="issueTitle" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">
                                    <i class="fas fa-print"></i> Ø§Ù„Ø·Ø±Ø§Ø² *
                                </label>
                                <input type="text" class="form-control" id="printerModel" required>
                            </div>
                            <div class="col-12">
                                <label class="form-label">
                                    <i class="fas fa-align-left"></i> ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©
                                </label>
                                <textarea class="form-control" id="issueDescription" rows="3" placeholder="Ø§ÙƒØªØ¨ ÙˆØµÙØ§Ù‹ Ù…ÙØµÙ„Ø§Ù‹ Ù„Ù„Ù…Ø´ÙƒÙ„Ø©..."></textarea>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">
                                    <i class="fas fa-barcode"></i> Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ *
                                </label>
                                <input type="text" class="form-control" id="serialNumber" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">
                                    <i class="fas fa-user"></i> Ø§Ù„Ø¹Ù…ÙŠÙ„ *
                                </label>
                                <select class="form-select" id="clientId" required>
                                    </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">
                                    <i class="fas fa-tint"></i> Ù†ÙˆØ¹ Ø§Ù„Ø­Ø¨Ø±
                                </label>
                                <input type="text" class="form-control" id="inkType" placeholder="Ù…Ø«Ø§Ù„: Ø­Ø¨Ø± Ø£Ø³ÙˆØ¯ØŒ Ù…Ù„ÙˆÙ†">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">
                                    <i class="fas fa-layer-group"></i> Ù†ÙˆØ¹ Ø§Ù„Ø³Ø·Ø­
                                </label>
                                <input type="text" class="form-control" id="surfaceType" placeholder="Ù…Ø«Ø§Ù„: ÙˆØ±Ù‚ØŒ Ø¨Ù„Ø§Ø³ØªÙŠÙƒ">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">
                                    <i class="fas fa-exclamation-triangle"></i> Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©
                                </label>
                                <select class="form-select" id="priority" required>
                                    <option value="1">ğŸ”¥ Ø¹Ø§Ù„ÙŠØ©</option>
                                    <option value="2" selected>âš¡ Ù…ØªÙˆØ³Ø·Ø©</option>
                                    <option value="3">ğŸ“ Ù…Ù†Ø®ÙØ¶Ø©</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">
                                    <i class="fas fa-user-edit"></i> Ø§Ù„Ù…Ø¨Ù„Øº Ø¹Ù†Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø©
                                </label>
                                <input type="text" class="form-control" id="reportedBy" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¨Ù„Øº">
                            </div>
                        </div>
                        <div class="mt-4 d-flex gap-2">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©
                            </button>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="editIssueModal" tabindex="-1" aria-labelledby="editIssueModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-warning text-white">
                    <h5 class="modal-title" id="editIssueModalLabel">
                        <i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editIssueForm">
                        <input type="hidden" id="editIssueId">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø´ÙƒÙ„Ø© *</label>
                                <input type="text" class="form-control" id="editIssueTitle" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Ø§Ù„Ø­Ø§Ù„Ø©</label>
                                <select class="form-select" id="editIssueStatus" required>
                                    <option value="open">Ù…ÙØªÙˆØ­Ø©</option>
                                    <option value="in_progress">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</option>
                                    <option value="solved">Ù…Ø­Ù„ÙˆÙ„Ø©</option>
                                    <option value="closed">Ù…ØºÙ„Ù‚Ø©</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <label class="form-label">ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</label>
                                <textarea class="form-control" id="editIssueDescription" rows="3"></textarea>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label>
                                <select class="form-select" id="editIssuePriority" required>
                                    <option value="1">Ø¹Ø§Ù„ÙŠØ©</option>
                                    <option value="2">Ù…ØªÙˆØ³Ø·Ø©</option>
                                    <option value="3">Ù…Ù†Ø®ÙØ¶Ø©</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">
                                    <i class="fas fa-hard-hat"></i> Ø§Ù„ÙÙ†ÙŠ Ø§Ù„Ù…Ø¹ÙŠÙ†
                                </label>
                                <select class="form-select" id="editIssueTechnicianId">
                                    <option value="">Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ¹ÙŠÙŠÙ†</option>
                                    </select>
                            </div>
                        </div>
                        <div class="mt-4 d-flex gap-2">
                            <button type="submit" class="btn btn-warning">
                                <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
                            </button>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="addClientModal" tabindex="-1" aria-labelledby="addClientModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="addClientModalLabel">
                        <i class="fas fa-user-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addClientForm">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ *</label>
                                <input type="text" class="form-control" id="clientName" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ *</label>
                                <input type="text" class="form-control" id="clientPhone" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                                <input type="email" class="form-control" id="clientEmail">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Ø§Ù„Ø´Ø±ÙƒØ©</label>
                                <input type="text" class="form-control" id="clientCompany">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
                                <input type="text" class="form-control" id="clientLocation">
                            </div>
                            <div class="col-md-6 d-flex align-items-end">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="clientServiceContract">
                                    <label class="form-check-label" for="clientServiceContract">
                                        Ø¹Ù‚Ø¯ Ø®Ø¯Ù…Ø©
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4 d-flex gap-2">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ø¹Ù…ÙŠÙ„
                            </button>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="addTechnicianModal" tabindex="-1" aria-labelledby="addTechnicianModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="addTechnicianModalLabel">
                        <i class="fas fa-user-tie"></i> Ø¥Ø¶Ø§ÙØ© ÙÙ†ÙŠ Ø¬Ø¯ÙŠØ¯
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addTechnicianForm">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Ø§Ø³Ù… Ø§Ù„ÙÙ†ÙŠ *</label>
                                <input type="text" class="form-control" id="technicianName" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Ø§Ù„ØªØ®ØµØµ</label>
                                <input type="text" class="form-control" id="technicianSpecialty">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Ø±Ù‚Ù… Ø§Ù„ØªÙˆØ§ØµÙ„</label>
                                <input type="text" class="form-control" id="technicianContact">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©</label>
                                <input type="number" class="form-control" id="technicianCertificationLevel" min="1">
                            </div>
                        </div>
                        <div class="mt-4 d-flex gap-2">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„ÙÙ†ÙŠ
                            </button>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>


    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

    <script>
        // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
        let allIssues = [];
        let filteredIssues = [];
        let allClients = []; // Ù„ØªØ®Ø²ÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
        let allTechnicians = []; // Ù„ØªØ®Ø²ÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙÙ†ÙŠÙŠÙ†
        let statusChart = null;
        let priorityChart = null;
        let currentView = 'card';

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        $(document).ready(function () {
            initializeApp();
            setupEventListeners();
            loadIssues();
            loadClients(); // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
            loadTechnicians(); // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙ†ÙŠÙŠÙ† Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
        });

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        function initializeApp() {
            // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª Ø¨ØµØ±ÙŠØ©
            $('body').addClass('fade-in');
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª
            initializeCharts();
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª
            updateCurrentTime();
            setInterval(updateCurrentTime, 60000); // ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
        }

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        function setupEventListeners() {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            $('#refreshData').click(function () {
                $(this).html('<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...');
                loadIssues();
                loadClients();
                loadTechnicians();
                setTimeout(() => {
                    $(this).html('<i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                }, 1000);
            });

            // Ø¥Ø¶Ø§ÙØ© Ù…Ø´ÙƒÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©
            $('#addIssueForm').submit(function (e) {
                e.preventDefault();
                addNewIssue();
            });

            // ØªØ¹Ø¯ÙŠÙ„ Ù…Ø´ÙƒÙ„Ø©
            $('#editIssueForm').submit(function (e) {
                e.preventDefault();
                updateIssue();
            });

            // Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯
            $('#addClientForm').submit(function (e) {
                e.preventDefault();
                addNewClient();
            });

            // Ø¥Ø¶Ø§ÙØ© ÙÙ†ÙŠ Ø¬Ø¯ÙŠØ¯
            $('#addTechnicianForm').submit(function (e) {
                e.preventDefault();
                addNewTechnician();
            });

            // ÙÙ„Ø§ØªØ± Ø§Ù„Ø¨Ø­Ø«
            $('#searchInput, #statusFilter, #priorityFilter, #modelFilter').on('input change', function () {
                filterIssues();
            });

            // Ù…Ø³Ø­ Ø§Ù„ÙÙ„Ø§ØªØ±
            $('#clearFilters').click(function () {
                clearAllFilters();
            });

            // ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            $('#exportData').click(function () {
                exportToCSV();
            });

            // ØªØºÙŠÙŠØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¹Ø±Ø¶
            $('#listView').click(function () {
                currentView = 'list';
                displayIssues(filteredIssues);
                $(this).addClass('active');
                $('#cardView').removeClass('active');
            });

            $('#cardView').click(function () {
                currentView = 'card';
                displayIssues(filteredIssues);
                $(this).addClass('active');
                $('#listView').removeClass('active');
            });

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„ØªØ¨ÙˆÙŠØ¨
            $('#stats-tab').on('shown.bs.tab', function () {
                loadStats();
            });

            $('#dashboard-tab').on('shown.bs.tab', function () {
                updateCharts();
            });
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø¹Ù†Ø¯ ÙØªØ­ ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
            $('#clients-tab').on('shown.bs.tab', function () {
                loadClients(true); // ØªÙ…Ø±ÙŠØ± true Ù„Ù„Ø¥Ø´Ø§Ø±Ø© Ø¥Ù„Ù‰ Ø£Ù†Ù†Ø§ Ù†Ø±ÙŠØ¯ Ø¹Ø±Ø¶Ù‡Ø§ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
            });

            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙ†ÙŠÙŠÙ† Ø¹Ù†Ø¯ ÙØªØ­ ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ÙÙ†ÙŠÙŠÙ†
            $('#technicians-tab').on('shown.bs.tab', function () {
                loadTechnicians(true); // ØªÙ…Ø±ÙŠØ± true Ù„Ù„Ø¥Ø´Ø§Ø±Ø© Ø¥Ù„Ù‰ Ø£Ù†Ù†Ø§ Ù†Ø±ÙŠØ¯ Ø¹Ø±Ø¶Ù‡Ø§ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
            });
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„
        function loadIssues() {
            showLoadingSpinner('#issuesList');
            
            $.ajax({
                url: '/api/problems',
                type: 'GET',
                success: function (response) {
                    if (response) { // Flask API returns direct JSON, not {data: ...}
                        allIssues = response;
                        filterIssues(); // ÙÙ„ØªØ±Ø© ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
                        updateStatistics();
                        updateIssuesCount();
                        showSuccessMessage('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø¨Ù†Ø¬Ø§Ø­');
                    } else {
                        showErrorMessage('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø© Ù„Ù„Ù…Ø´Ø§ÙƒÙ„');
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„:', error);
                    $('#issuesList').html(`
                        <div class="alert alert-danger" role="alert">
                            <i class="fas fa-exclamation-triangle"></i>
                            ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.
                            <button class="btn btn-sm btn-outline-danger ms-2" onclick="loadIssues()">
                                <i class="fas fa-redo"></i> Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
                            </button>
                        </div>
                    `);
                }
            });
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
        function loadClients(displayInList = false) {
            if (displayInList) {
                showLoadingSpinner('#clientsList');
            }
            $.ajax({
                url: '/api/clients',
                type: 'GET',
                success: function (response) {
                    if (response) {
                        allClients = response;
                        populateClientDropdowns();
                        updateClientsCount();
                        if (displayInList) {
                            displayClients(allClients);
                        }
                    } else {
                        if (displayInList) {
                            $('#clientsList').html('<div class="alert alert-info">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù…ØªØ§Ø­Ø©.</div>');
                        }
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡:', error);
                    if (displayInList) {
                        $('#clientsList').html(`
                            <div class="alert alert-danger" role="alert">
                                ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡.
                            </div>
                        `);
                    }
                }
            });
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙÙŠ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø®Ø§Øµ Ø¨Ù‡Ù…
        function displayClients(clients) {
            const container = $('#clientsList');
            container.empty();
            if (clients.length === 0) {
                container.html(`
                    <div class="text-center py-5">
                        <i class="fas fa-users fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡ Ù…Ø³Ø¬Ù„ÙŠÙ†</h5>
                        <p class="text-muted">ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø²Ø± Ø£Ø¹Ù„Ø§Ù‡</p>
                    </div>
                `);
                return;
            }

            const tableHtml = `
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>Ø§Ù„Ø§Ø³Ù…</th>
                                <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
                                <th>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
                                <th>Ø§Ù„Ø´Ø±ÙƒØ©</th>
                                <th>Ø¹Ù‚Ø¯ Ø®Ø¯Ù…Ø©</th>
                                <th>Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${clients.map(client => `
                                <tr>
                                    <td>${client.name}</td>
                                    <td>${client.contact_phone}</td>
                                    <td>${client.email || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}</td>
                                    <td>${client.company || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}</td>
                                    <td>${client.service_contract ? '<i class="fas fa-check-circle text-success"></i>' : '<i class="fas fa-times-circle text-danger"></i>'}</td>
                                    <td>${client.location || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}</td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary" onclick="editClient(${client.id})">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-danger" onclick="deleteClient(${client.id})">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            container.html(tableHtml);
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙ†ÙŠÙŠÙ†
        function loadTechnicians(displayInList = false) {
            if (displayInList) {
                showLoadingSpinner('#techniciansList');
            }
            $.ajax({
                url: '/api/technicians',
                type: 'GET',
                success: function (response) {
                    if (response) {
                        allTechnicians = response;
                        populateTechnicianDropdowns();
                        updateTechniciansCount();
                        if (displayInList) {
                            displayTechnicians(allTechnicians);
                        }
                    } else {
                        if (displayInList) {
                            $('#techniciansList').html('<div class="alert alert-info">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ÙÙ†ÙŠÙŠÙ† Ù…ØªØ§Ø­Ø©.</div>');
                        }
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙ†ÙŠÙŠÙ†:', error);
                    if (displayInList) {
                        $('#techniciansList').html(`
                            <div class="alert alert-danger" role="alert">
                                ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙ†ÙŠÙŠÙ†.
                            </div>
                        `);
                    }
                }
            });
        }

        // Ø¹Ø±Ø¶ Ø§Ù„ÙÙ†ÙŠÙŠÙ† ÙÙŠ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø®Ø§Øµ Ø¨Ù‡Ù…
        function displayTechnicians(technicians) {
            const container = $('#techniciansList');
            container.empty();
            if (technicians.length === 0) {
                container.html(`
                    <div class="text-center py-5">
                        <i class="fas fa-hard-hat fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙ†ÙŠÙŠÙ† Ù…Ø³Ø¬Ù„ÙŠÙ†</h5>
                        <p class="text-muted">ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© ÙÙ†ÙŠ Ø¬Ø¯ÙŠØ¯ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø²Ø± Ø£Ø¹Ù„Ø§Ù‡</p>
                    </div>
                `);
                return;
            }

            const tableHtml = `
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>Ø§Ù„Ø§Ø³Ù…</th>
                                <th>Ø§Ù„ØªØ®ØµØµ</th>
                                <th>Ø§Ù„ØªÙˆØ§ØµÙ„</th>
                                <th>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${technicians.map(tech => `
                                <tr>
                                    <td>${tech.name}</td>
                                    <td>${tech.specialty || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}</td>
                                    <td>${tech.contact || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}</td>
                                    <td>${tech.certification_level || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary" onclick="editTechnician(${tech.id})">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-danger" onclick="deleteTechnician(${tech.id})">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            container.html(tableHtml);
        }

        // Ù…Ù„Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡
        function populateClientDropdowns() {
            const clientSelect = $('#clientId');
            clientSelect.empty();
            clientSelect.append('<option value="">Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„...</option>');
            allClients.forEach(client => {
                clientSelect.append(`<option value="${client.id}">${client.name} - ${client.company || ''}</option>`);
            });
        }

        // Ù…Ù„Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ù„Ù„ÙÙ†ÙŠÙŠÙ†
        function populateTechnicianDropdowns() {
            const technicianSelect = $('#editIssueTechnicianId');
            technicianSelect.empty();
            technicianSelect.append('<option value="">Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ¹ÙŠÙŠÙ†</option>');
            allTechnicians.forEach(technician => {
                technicianSelect.append(`<option value="${technician.id}">${technician.name}</option>`);
            });
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„
        function displayIssues(issues) {
            const container = $('#issuesList');
            container.empty();

            if (issues.length === 0) {
                container.html(`
                    <div class="text-center py-5">
                        <i class="fas fa-search fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§ÙƒÙ„ Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¨Ø­Ø«</h5>
                        <p class="text-muted">Ø¬Ø±Ø¨ ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø« Ø£Ùˆ Ù…Ø³Ø­ Ø§Ù„ÙÙ„Ø§ØªØ±</p>
                    </div>
                `);
                return;
            }

            if (currentView === 'list') {
                displayListView(issues, container);
            } else {
                displayCardView(issues, container);
            }
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
        function displayCardView(issues, container) {
            const cardsHtml = issues.map(issue => {
                const clientName = allClients.find(c => c.id === issue.client_id)?.name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const technicianName = allTechnicians.find(t => t.id === issue.technician_id)?.name || 'Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ¹ÙŠÙŠÙ†';
                return `
                <div class="col-md-6 col-lg-4 mb-4">
                    <div class="card h-100 issue-card" data-issue-id="${issue.id}">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h6 class="mb-0">${issue.title}</h6>
                            <div class="dropdown">
                                <button class="btn btn-sm" type="button" data-bs-toggle="dropdown">
                                    <i class="fas fa-ellipsis-v"></i>
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="#" onclick="editIssue(${issue.id})">
                                        <i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„
                                    </a></li>
                                    <li><a class="dropdown-item text-danger" href="#" onclick="deleteIssue(${issue.id})">
                                        <i class="fas fa-trash"></i> Ø­Ø°Ù
                                    </a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="card-body">
                            <p class="card-text">${issue.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ'}</p>
                            <div class="row g-2 mb-3">
                                <div class="col-6">
                                    <small class="text-muted">Ø§Ù„Ø·Ø±Ø§Ø²:</small>
                                    <div class="fw-bold">${issue.model}</div>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">Ø§Ù„Ø¹Ù…ÙŠÙ„:</small>
                                    <div class="fw-bold">${clientName}</div>
                                </div>
                                <div class="col-12">
                                    <small class="text-muted">Ø§Ù„ÙÙ†ÙŠ Ø§Ù„Ù…Ø¹ÙŠÙ†:</small>
                                    <div class="fw-bold">${technicianName}</div>
                                </div>
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="priority-badge priority-${issue.priority}">
                                    ${getPriorityText(issue.priority)}
                                </span>
                                <span class="status-badge status-${issue.status}">
                                    ${getStatusText(issue.status)}
                                </span>
                            </div>
                        </div>
                        <div class="card-footer text-muted">
                            <small>
                                <i class="fas fa-clock"></i>
                                ${formatDate(issue.created_at)}
                            </small>
                        </div>
                    </div>
                </div>
            `;
            }).join('');

            container.html(`<div class="row">${cardsHtml}</div>`);
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        function displayListView(issues, container) {
            const tableHtml = `
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                                <th>Ø§Ù„Ø·Ø±Ø§Ø²</th>
                                <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                                <th>Ø§Ù„ÙÙ†ÙŠ</th>
                                <th>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${issues.map(issue => {
                                const clientName = allClients.find(c => c.id === issue.client_id)?.name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                                const technicianName = allTechnicians.find(t => t.id === issue.technician_id)?.name || 'Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ¹ÙŠÙŠÙ†';
                                return `
                                <tr>
                                    <td>${issue.title}</td>
                                    <td>${issue.model}</td>
                                    <td>${clientName}</td>
                                    <td>${technicianName}</td>
                                    <td><span class="priority-badge priority-${issue.priority}">${getPriorityText(issue.priority)}</span></td>
                                    <td><span class="status-badge status-${issue.status}">${getStatusText(issue.status)}</span></td>
                                    <td>${formatDate(issue.created_at)}</td>
                                    <td>
                                        <div class="btn-group" role="group">
                                            <button class="btn btn-sm btn-outline-primary" onclick="editIssue(${issue.id})">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-sm btn-outline-danger" onclick="deleteIssue(${issue.id})">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            container.html(tableHtml);
        }

        // Ø¥Ø¶Ø§ÙØ© Ù…Ø´ÙƒÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©
        function addNewIssue() {
            const issueData = {
                title: $('#issueTitle').val(),
                description: $('#issueDescription').val(),
                model: $('#printerModel').val(),
                serial_number: $('#serialNumber').val(),
                client_id: parseInt($('#clientId').val()), // ØªÙ… ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ Ù„ØªÙƒÙˆÙ† Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ù…Ù†Ø³Ø¯Ù„Ø©
                ink_type: $('#inkType').val(),
                surface_type: $('#surfaceType').val(),
                priority: parseInt($('#priority').val()),
                reported_by: $('#reportedBy').val(),
                status: 'open'
            };

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù‚Ø¯ ØªÙ… Ø§Ø®ØªÙŠØ§Ø±Ù‡
            if (!issueData.client_id) {
                showErrorMessage('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ù…ÙŠÙ„.');
                return;
            }

            $.ajax({
                url: '/api/problems',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(issueData),
                success: function (response) {
                    showSuccessMessage('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø¨Ù†Ø¬Ø§Ø­!');
                    $('#addIssueModal').modal('hide');
                    $('#addIssueForm')[0].reset();
                    loadIssues();
                },
                error: function (xhr) {
                    showErrorMessage('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø´ÙƒÙ„Ø©: ' + (xhr.responseJSON ? xhr.responseJSON.error : xhr.responseText));
                }
            });
        }

        // ØªØ¹Ø¯ÙŠÙ„ Ù…Ø´ÙƒÙ„Ø©
        function editIssue(issueId) {
            const issue = allIssues.find(i => i.id === issueId);
            if (!issue) return;

            // Ù…Ù„Ø¡ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            $('#editIssueId').val(issue.id);
            $('#editIssueTitle').val(issue.title);
            $('#editIssueDescription').val(issue.description);
            $('#editIssueStatus').val(issue.status);
            $('#editIssuePriority').val(issue.priority);
            
            // Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙÙ†ÙŠÙŠÙ† Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© ÙˆØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙÙ†ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ
            populateTechnicianDropdowns(); // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù…Ù…Ù„ÙˆØ¡Ø©
            $('#editIssueTechnicianId').val(issue.technician_id || ''); // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙÙ†ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ Ø£Ùˆ Ù„Ø§ Ø´ÙŠØ¡

            $('#editIssueModal').modal('show');
        }

        // ØªØ­Ø¯ÙŠØ« Ù…Ø´ÙƒÙ„Ø©
        function updateIssue() {
            const issueId = $('#editIssueId').val();
            const updateData = {
                title: $('#editIssueTitle').val(),
                description: $('#editIssueDescription').val(),
                status: $('#editIssueStatus').val(),
                priority: parseInt($('#editIssuePriority').val()),
                technician_id: $('#editIssueTechnicianId').val() === '' ? null : parseInt($('#editIssueTechnicianId').val()) // Ø¥Ø±Ø³Ø§Ù„ null Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± ÙÙ†ÙŠ
            };

            $.ajax({
                url: `/api/problems/${issueId}`,
                type: 'PUT',
                contentType: 'application/json',
                data: JSON.stringify(updateData),
                success: function (response) {
                    showSuccessMessage('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø¨Ù†Ø¬Ø§Ø­!');
                    $('#editIssueModal').modal('hide');
                    loadIssues();
                },
                error: function (xhr) {
                    showErrorMessage('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø´ÙƒÙ„Ø©: ' + (xhr.responseJSON ? xhr.responseJSON.error : xhr.responseText));
                }
            });
        }

        // Ø­Ø°Ù Ù…Ø´ÙƒÙ„Ø©
        function deleteIssue(issueId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©ØŸ')) return;

            $.ajax({
                url: `/api/problems/${issueId}`,
                type: 'DELETE',
                success: function (response) {
                    showSuccessMessage('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø¨Ù†Ø¬Ø§Ø­!');
                    loadIssues();
                },
                error: function (xhr) {
                    showErrorMessage('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ø´ÙƒÙ„Ø©: ' + (xhr.responseJSON ? xhr.responseJSON.error : xhr.responseText));
                }
            });
        }

        // ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ø´Ø§ÙƒÙ„
        function filterIssues() {
            const searchTerm = $('#searchInput').val().toLowerCase();
            const statusFilter = $('#statusFilter').val();
            const priorityFilter = $('#priorityFilter').val();
            const modelFilter = $('#modelFilter').val().toLowerCase();

            filteredIssues = allIssues.filter(issue => {
                const matchesSearch = !searchTerm || 
                    issue.title.toLowerCase().includes(searchTerm) ||
                    (issue.description && issue.description.toLowerCase().includes(searchTerm)) ||
                    (issue.client_name && issue.client_name.toLowerCase().includes(searchTerm)) ||
                    (issue.technician_name && issue.technician_name.toLowerCase().includes(searchTerm)); // Ø§Ù„Ø¨Ø­Ø« Ø£ÙŠØ¶Ø§Ù‹ Ø¨Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„ÙÙ†ÙŠÙŠÙ†
                
                const matchesStatus = !statusFilter || issue.status === statusFilter;
                const matchesPriority = !priorityFilter || issue.priority.toString() === priorityFilter;
                const matchesModel = !modelFilter || issue.model.toLowerCase().includes(modelFilter);

                return matchesSearch && matchesStatus && matchesPriority && matchesModel;
            });

            displayIssues(filteredIssues);
            updateIssuesCount();
        }

        // Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙ„Ø§ØªØ±
        function clearAllFilters() {
            $('#searchInput').val('');
            $('#statusFilter').val('');
            $('#priorityFilter').val('');
            $('#modelFilter').val('');
            filterIssues(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ± Ø¨Ù…Ø³Ø­Ù‡Ø§
            showSuccessMessage('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙ„Ø§ØªØ±');
        }

        // Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯
        function addNewClient() {
            const clientData = {
                name: $('#clientName').val(),
                contact_phone: $('#clientPhone').val(),
                email: $('#clientEmail').val(),
                company: $('#clientCompany').val(),
                service_contract: $('#clientServiceContract').is(':checked'),
                location: $('#clientLocation').val()
            };

            $.ajax({
                url: '/api/clients',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(clientData),
                success: function (response) {
                    showSuccessMessage('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!');
                    $('#addClientModal').modal('hide');
                    $('#addClientForm')[0].reset();
                    loadClients(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
                },
                error: function (xhr) {
                    showErrorMessage('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…ÙŠÙ„: ' + (xhr.responseJSON ? xhr.responseJSON.error : xhr.responseText));
                }
            });
        }

        // Ø¥Ø¶Ø§ÙØ© ÙÙ†ÙŠ Ø¬Ø¯ÙŠØ¯
        function addNewTechnician() {
            const technicianData = {
                name: $('#technicianName').val(),
                specialty: $('#technicianSpecialty').val(),
                contact: $('#technicianContact').val(),
                certification_level: parseInt($('#technicianCertificationLevel').val()) || null
            };

            $.ajax({
                url: '/api/technicians',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(technicianData),
                success: function (response) {
                    showSuccessMessage('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙÙ†ÙŠ Ø¨Ù†Ø¬Ø§Ø­!');
                    $('#addTechnicianModal').modal('hide');
                    $('#addTechnicianForm')[0].reset();
                    loadTechnicians(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙÙ†ÙŠÙŠÙ† ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
                },
                error: function (xhr) {
                    showErrorMessage('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙÙ†ÙŠ: ' + (xhr.responseJSON ? xhr.responseJSON.error : xhr.responseText));
                }
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„ÙÙ†ÙŠÙŠÙ† ÙÙŠ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        function updateClientsCount() {
            $('#clientsCount').text(allClients.length);
        }

        function updateTechniciansCount() {
            $('#techniciansCount').text(allTechnicians.length);
        }

        // (Ø§Ù„Ø¯ÙˆØ§Ù„ loadStats, displayDetailedStats, updateStatistics, updateIssuesCount, initializeCharts, updateCharts, exportToCSV, convertToCSV, downloadCSV, getPriorityText, getStatusText, formatDate, showLoadingSpinner, showSuccessMessage, showErrorMessage, showToast, updateCurrentTime ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ Ø£Ùˆ ÙŠØªÙ… ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø©)
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        function loadStats() {
            showLoadingSpinner('#statsList');
            
            $.ajax({
                url: '/api/statistics',
                type: 'GET',
                success: function (response) {
                    if (response) {
                        displayDetailedStats(response); // ØªØºÙŠÙŠØ± Ù‡Ù†Ø§ Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù…Ø¨Ø§Ø´Ø±Ø©
                    } else {
                        $('#statsList').html('<div class="alert alert-info">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…ØªØ§Ø­Ø©</div>');
                    }
                },
                error: function () {
                    $('#statsList').html('<div class="alert alert-danger">ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</div>');
                }
            });
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©
        function displayDetailedStats(data) {
            const statsHtml = `
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-chart-bar"></i> Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø´Ø§Ù…Ù„Ø©</h5>
                            </div>
                            <div class="card-body">
                                <pre class="bg-light p-3 rounded" style="max-height: 300px; overflow-y: auto;">${JSON.stringify(data, null, 2)}</pre>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-info-circle"></i> Ù…Ù„Ø®Øµ Ø³Ø±ÙŠØ¹</h5>
                            </div>
                            <div class="card-body">
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item d-flex justify-content-between">
                                        <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„:</span>
                                        <strong>${allIssues.length}</strong>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between">
                                        <span>Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ù…ÙØªÙˆØ­Ø©:</span>
                                        <strong>${data.problems_by_status.open || 0}</strong>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between">
                                        <span>Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©:</span>
                                        <strong>${data.problems_by_status.in_progress || 0}</strong>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between">
                                        <span>Ø§Ù„Ù…Ø­Ù„ÙˆÙ„Ø©:</span>
                                        <strong>${data.problems_by_status.solved || 0}</strong>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between">
                                        <span>Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©:</span>
                                        <strong>${data.problems_by_priority['1'] || 0}</strong>
                                    </li>
                                     <li class="list-group-item d-flex justify-content-between">
                                        <span>Ù…ØªÙˆØ³Ø· Ø§Ù„Ø­Ù„ÙˆÙ„ Ù„ÙƒÙ„ Ù…Ø´ÙƒÙ„Ø©:</span>
                                        <strong>${(data.avg_solutions_per_problem || 0).toFixed(2)}</strong>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            $('#statsList').html(statsHtml);
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø© (ÙÙŠ Ø¨Ø·Ø§Ù‚Ø§Øª Overview)
        function updateStatistics() {
            $('#totalIssues').text(allIssues.length);
            $('#inProgressIssues').text(allIssues.filter(i => i.status === 'in_progress').length);
            $('#solvedIssues').text(allIssues.filter(i => i.status === 'solved').length);
            $('#highPriorityIssues').text(allIssues.filter(i => i.priority === 1).length);
        }

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ ÙÙŠ Ø§Ù„ØªØ¨ÙˆÙŠØ¨
        function updateIssuesCount() {
            $('#issuesCount').text(filteredIssues.length);
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª
        function initializeCharts() {
            const statusCtx = document.getElementById('statusChart');
            if (statusCtx && !statusChart) { // ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø¯Ù… ØªÙ‡ÙŠØ¦ØªÙ‡Ø§ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
                statusChart = new Chart(statusCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Ù…ÙØªÙˆØ­Ø©', 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©', 'Ù…Ø­Ù„ÙˆÙ„Ø©', 'Ù…ØºÙ„Ù‚Ø©'],
                        datasets: [{
                            data: [0, 0, 0, 0],
                            backgroundColor: ['#3b82f6', '#f59e0b', '#10b981', '#6b7280']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }

            const priorityCtx = document.getElementById('priorityChart');
            if (priorityCtx && !priorityChart) { // ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø¯Ù… ØªÙ‡ÙŠØ¦ØªÙ‡Ø§ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
                priorityChart = new Chart(priorityCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Ø¹Ø§Ù„ÙŠØ©', 'Ù…ØªÙˆØ³Ø·Ø©', 'Ù…Ù†Ø®ÙØ¶Ø©'],
                        datasets: [{
                            label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„',
                            data: [0, 0, 0],
                            backgroundColor: ['#ef4444', '#f59e0b', '#10b981']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    precision: 0 // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØµØ­ÙŠØ­Ø© ÙÙ‚Ø· Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­ÙˆØ± Y
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª
        function updateCharts() {
            // Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª Ø¨Ø¨ÙŠØ§Ù†Ø§Øª Ø¯Ù‚ÙŠÙ‚Ø©
            $.ajax({
                url: '/api/statistics',
                type: 'GET',
                success: function (data) {
                    if (statusChart && data.problems_by_status) {
                        statusChart.data.datasets[0].data = [
                            data.problems_by_status.open || 0,
                            data.problems_by_status.in_progress || 0,
                            data.problems_by_status.solved || 0,
                            data.problems_by_status.closed || 0
                        ];
                        statusChart.update();
                    }

                    if (priorityChart && data.problems_by_priority) {
                        priorityChart.data.datasets[0].data = [
                            data.problems_by_priority['1'] || 0,
                            data.problems_by_priority['2'] || 0,
                            data.problems_by_priority['3'] || 0
                        ];
                        priorityChart.update();
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª:', error);
                }
            });
        }


        // ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function exportToCSV() {
            const csvData = convertToCSV(filteredIssues);
            downloadCSV(csvData, 'issues_export.csv');
            showSuccessMessage('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!');
        }

        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ CSV
        function convertToCSV(data) {
            const headers = ['Ø§Ù„Ø¹Ù†ÙˆØ§Ù†', 'Ø§Ù„ÙˆØµÙ', 'Ø§Ù„Ø·Ø±Ø§Ø²', 'Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ', 'Ø§Ù„Ø¹Ù…ÙŠÙ„', 'Ø§Ù„ÙÙ†ÙŠ Ø§Ù„Ù…Ø¹ÙŠÙ†', 'Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©', 'Ø§Ù„Ø­Ø§Ù„Ø©', 'Ø§Ù„ØªØ§Ø±ÙŠØ®'];
            const rows = data.map(issue => {
                const clientName = allClients.find(c => c.id === issue.client_id)?.name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const technicianName = allTechnicians.find(t => t.id === issue.technician_id)?.name || 'Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ¹ÙŠÙŠÙ†';
                return [
                    issue.title,
                    issue.description || '',
                    issue.model,
                    issue.serial_number,
                    clientName,
                    technicianName,
                    getPriorityText(issue.priority),
                    getStatusText(issue.status),
                    formatDate(issue.created_at)
                ];
            });
            
            return [headers, ...rows].map(row => row.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(',')).join('\n'); // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ÙÙˆØ§ØµÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        }

        // ØªÙ†Ø²ÙŠÙ„ Ù…Ù„Ù CSV
        function downloadCSV(csvData, filename) {
            const blob = new Blob([csvData], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
        }

        // ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø©
        function getPriorityText(priority) {
            const priorities = { 1: 'Ø¹Ø§Ù„ÙŠØ©', 2: 'Ù…ØªÙˆØ³Ø·Ø©', 3: 'Ù…Ù†Ø®ÙØ¶Ø©' };
            return priorities[priority] || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        }

        function getStatusText(status) {
            const statuses = {
                'open': 'Ù…ÙØªÙˆØ­Ø©',
                'in_progress': 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©',
                'solved': 'Ù…Ø­Ù„ÙˆÙ„Ø©',
                'closed': 'Ù…ØºÙ„Ù‚Ø©',
                'pending_parts': 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ù‚Ø·Ø¹ ØºÙŠØ§Ø±' // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù‡Ù†Ø§
            };
            return statuses[status] || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        }

        function formatDate(dateString) {
            if (!dateString) return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            const date = new Date(dateString);
            return date.toLocaleDateString('ar-EG', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' });
        }

        function showLoadingSpinner(selector) {
            $(selector).html(`
                <div class="loading-spinner">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
                </div>
            `);
        }

        function showSuccessMessage(message) {
            showToast(message, 'success');
        }

        function showErrorMessage(message) {
            showToast(message, 'error');
        }

        function showToast(message, type = 'info') {
            const toastClass = type === 'success' ? 'bg-success' : type === 'error' ? 'bg-danger' : 'bg-info';
            const toast = $(`
                <div class="toast align-items-center text-white ${toastClass} border-0 position-fixed top-0 end-0 m-3" role="alert" style="z-index: 9999;">
                    <div class="d-flex">
                        <div class="toast-body">
                            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : 'info-circle'}"></i>
                            ${message}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                    </div>
                </div>
            `);
            
            $('body').append(toast);
            const bsToast = new bootstrap.Toast(toast[0]);
            bsToast.show();
            
            setTimeout(() => {
                toast.remove();
            }, 5000);
        }

        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleString('ar-EG');
            // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø¹Ø±Ø¶ Ø§Ù„ÙˆÙ‚Øª ÙÙŠ Ù…ÙƒØ§Ù† Ù…Ø§ ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¥Ø°Ø§ Ø±ØºØ¨Øª
        }

        // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª Ø¨ØµØ±ÙŠØ© Ù„Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
        $(document).on('mouseenter', '.issue-card', function() {
            $(this).addClass('shadow-lg').css('transform', 'translateY(-5px)');
        });

        $(document).on('mouseleave', '.issue-card', function() {
            $(this).removeClass('shadow-lg').css('transform', 'translateY(0)');
        });

        // Ø¥Ø¶Ø§ÙØ© Ø§Ø®ØªØµØ§Ø±Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
        $(document).keydown(function(e) {
            if (e.ctrlKey) {
                switch(e.which) {
                    case 78: // Ctrl+N
                        e.preventDefault();
                        $('#addIssueModal').modal('show');
                        break;
                    case 82: // Ctrl+R
                        e.preventDefault();
                        loadIssues();
                        break;
                    case 70: // Ctrl+F
                        e.preventDefault();
                        $('#searchInput').focus();
                        break;
                }
            }
        });
    </script>
</body>
</html>